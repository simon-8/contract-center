/* jQuery photoClip v1.7.0 | Relying on the plug-in [iscroll-zoom.js] [hammer.js] [lrz.all.bundle.js] */
!function(t,o){"use strict";"function"==typeof define&&define.amd?define(["jquery","iscroll-zoom","hammer","lrz"],o):"object"==typeof exports?module.exports=o(require("jquery"),require("iscroll-zoom"),require("hammer"),require("lrz")):o(t.jQuery,t.IScroll,t.Hammer,t.lrz)}(this,function(t,o,e,n){"use strict";function i(i,s){function c(){K=!0,_.append(this),y.call(this,B,function(){G=this.naturalWidth,J=this.naturalHeight}),y($,function(){p()}),W.call(this,this.src)}function l(){var t={zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,mouseWheel:!0,wheelAction:"zoom"};eo=new o(V[0],t)}function p(){co=0,lo=0,po=0,_.css({width:G,height:J}),F(_,co,lo,po),T(G,J),eo.zoom(eo.options.zoomStart),u(G,J);var t=.5*(U-G*eo.options.zoomStart),o=.5*(X-J*eo.options.zoomStart);eo.scrollTo(t,o)}function u(t,o){$.css({width:t,height:o}),V.append($),eo.refresh()}function f(){var t=!!navigator.userAgent.match(/mobile/i);if(t){var o=new e($[0]);o.add(new e.Rotate);var n,i;o.on("rotatemove",function(t){so||(n=t.rotation,n>180?n-=360:-180>n&&(n+=360),i=n>0?1:0>n?-1:0)}),o.on("rotateend",function(t){so||Math.abs(n)>30&&(1==i?d(t.center):-1==i&&h(t.center))})}else $.on("dblclick",function(t){d({x:t.clientX,y:t.clientY})})}function d(t){m(90,t)}function h(t){m(-90,t)}function m(t,o){if(!so){so=!0;var e;e=o?w($,o.x,o.y):x($,V,.5*U,.5*X);var n,i,a=z(po,e),r=a.x,s=a.y,c=0,l=0,p=0,f=0,d=po+t;90==d||-270==d?(c=r+s,l=s-r,d>po?(p=J-r-s,f=r-s):po>d&&(p=J-s-(G-r),f=r+s-J),n=J,i=G):180==d||-180==d?(c=2*r,l=2*s,d>po?(p=G-r-(J-s),f=J-(r+s)):po>d&&(p=G-(r+s),f=J-s-(G-r)),n=G,i=J):270==d||-90==d?(c=r-s,l=r+s,d>po?(p=r+s-G,f=G-r-(J-s)):po>d&&(p=s-r,f=G-r-s),n=J,i=G):(0==d||360==d||-360==d)&&(c=0,l=0,d>po?(p=r-s,f=r+s-G):po>d&&(p=r+s-J,f=s-r),n=G,i=J),0==po?(co=0,lo=0):90==po||-270==po?(co-=r+s,lo-=s-r):180==po||-180==po?(co-=2*r,lo-=2*s):(270==po||-90==po)&&(co-=r-s,lo-=r+s),co=co.toFixed(2)-0,lo=lo.toFixed(2)-0,F(_,co,lo,po,r,s),L(_,co,lo,d,200,function(){so=!1,po=d%360,co+=c+p,lo+=l+f,co=co.toFixed(2)-0,lo=lo.toFixed(2)-0,F(_,co,lo,po),eo.scrollTo(eo.x-p*eo.scale,eo.y-f*eo.scale),T(n,i),eo.scale<eo.options.zoomMin&&eo.zoom(eo.options.zoomMin),u(n,i)})}}function g(){oo=document.createElement("canvas")}function v(){if(!K)return void alert("亲，当前没有图片可以裁剪!");var t=x($,V),o=eo.scale,e=oo.getContext("2d");e.clearRect(0,0,oo.width,oo.height),e.save(),Y&&Z?(oo.width=Y,oo.height=Z,e.scale(Y/U*o,Z/X*o)):(oo.width=U/o,oo.height=X/o),e.translate(co-t.x/o,lo-t.y/o),e.rotate(po*Math.PI/180),e.drawImage(B[0],0,0),e.restore();var n=oo.toDataURL(H,1);to.css("background-image","url("+n+")"),O.call(B[0],n)}function b(){y(N,function(){no=N.width(),io=N.height()})}function x(t,o,e,n){e=e||0,n=n||0;var i,a;return y(t,function(){i=t.offset()}),y(o,function(){a=o.offset()}),{x:a.left-i.left+e,y:a.top-i.top+n}}function w(t,o,e){o=o||0,e=e||0;var n;return y(t,function(){n=t.offset()}),{x:o+ro.scrollLeft()-n.left,y:e+ro.scrollTop()-n.top}}function y(o,e){var n=t();t.each(o,function(o,e){for(var i,a=t(e),r=a.parents().andSelf().filter(":hidden"),o=0;o<r.length&&a.is(":hidden");o++)i=r.eq(o),"none"==i.css("display")&&(n=n.add(i.show()))}),"function"==typeof e&&e.call(this),n.hide()}function z(t,o){var e=eo.scale,n={};return 0==t?(n.x=o.x/e,n.y=o.y/e):90==t||-270==t?(n.x=o.y/e,n.y=J-o.x/e):180==t||-180==t?(n.x=G-o.x/e,n.y=J-o.y/e):(270==t||-90==t)&&(n.x=G-o.y/e,n.y=o.x/e),n}function k(t,o,e,n){var i=t/e,a=o/n;return i>a?i:a}function T(t,o){eo.options.zoomMin=k(U,X,t,o),eo.options.zoomMax=Math.max(1,eo.options.zoomMin),eo.options.zoomStart=Math.min(eo.options.zoomMax,k(no,io,t,o))}function M(){B&&B.length&&(B.remove(),delete B[0])}function S(o){M(),B=t("<img>").css({"user-select":"none","pointer-events":"none"}),B.load(c),B.attr("src",o)}function F(t,o,e,n,i,a){i=i||0,a=a||0;var s={};s[r+"transform"]="translateZ(0) translate("+o+"px,"+e+"px) rotate("+n+"deg)",s[r+"transform-origin"]=i+"px "+a+"px",t.css(s)}function L(t,o,e,n,i,s){t.css(r+"transform"),t.css(r+"transition",r+"transform "+i+"ms"),t.one(a,function(){t.css(r+"transition",""),s.call(this)}),t.css(r+"transform","translateZ(0) translate("+o+"px,"+e+"px) rotate("+n+"deg)")}function j(t){return"[object Array]"===Object.prototype.toString.call(t)}function q(){N=t(i).css({"user-select":"none",overflow:"hidden"}),"static"==N.css("position")&&N.css("position","relative"),V=t("<div class='photo-clip-view'>").css({position:"absolute",left:"50%",top:"50%",width:U,height:X,"margin-left":-U/2,"margin-top":-X/2}).appendTo(N),$=t("<div class='photo-clip-moveLayer'>").appendTo(V),_=t("<div class='photo-clip-rotateLayer'>").appendTo($);{var o=t("<div class='photo-clip-mask'>").css({position:"absolute",left:0,top:0,width:"100%",height:"100%","pointer-events":"none"}).appendTo(N);t("<div class='photo-clip-mask-left'>").css({position:"absolute",left:0,right:"50%",top:"50%",bottom:"50%",width:"auto",height:X,"margin-right":U/2,"margin-top":-X/2,"margin-bottom":-X/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-mask-right'>").css({position:"absolute",left:"50%",right:0,top:"50%",bottom:"50%","margin-left":U/2,"margin-top":-X/2,"margin-bottom":-X/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-mask-top'>").css({position:"absolute",left:0,right:0,top:0,bottom:"50%","margin-bottom":X/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-mask-bottom'>").css({position:"absolute",left:0,right:0,top:"50%",bottom:0,"margin-top":X/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-area'>").css({border:"1px dashed #ddd",position:"absolute",left:"50%",top:"50%",width:U,height:X,"margin-left":-U/2-1,"margin-top":-X/2-1}).appendTo(o)}to=t(E),to.length&&to.css({"background-color":"#666","background-repeat":"no-repeat","background-position":"center","background-size":"contain"})}var R=s.size,C=s.outputSize,A=s.file,E=s.view,I=s.ok,H="image/jpeg",P=s.loadStart,W=s.loadComplete,D=s.loadError,O=s.clipFinish;j(R)||(R=[260,260]),j(C)||(C=[0,0]);var U=R[0]||260,X=R[1]||260,Y=Math.max(C[0],0),Z=Math.max(C[1],0),Q=t(A);if(Q.length){var B,G,J,K;Q.attr("accept","image/*"),Q.change(function(){if(this.files.length){var t=this.files[0];if(!/image\/\w+/.test(t.type))return alert("图片格式不正确，请选择正确格式的图片文件！"),!1;var o=new FileReader;o.onprogress=function(t){console.log((t.loaded/t.total*100).toFixed()+"%")},o.onload=function(){n(t).then(function(t){S(t.base64)}).catch(function(t){alert("图片处理失败"),D.call(this,t)})},o.onerror=function(t){alert("图片加载失败"),D.call(this,t)},o.readAsDataURL(t),P.call(o,t)}}),Q.click(function(){this.value=""});var N,V,$,_,to,oo,eo,no,io;q(),l(),f(),g();var ao=t(I);ao.length&&ao.click(function(){v()});var ro=t(window);b(),ro.resize(b);var so,co,lo,po}}t.fn.photoClip=function(o){if(!window.FileReader)return void alert("您的浏览器不支持 HTML5 的 FileReader API， 因此无法初始化图片裁剪插件，请更换最新的浏览器！");var e={size:[260,260],outputSize:[0,0],file:"",view:"",ok:"",loadStart:function(){},loadComplete:function(){},loadError:function(){},clipFinish:function(){}};return t.extend(e,o),this.each(function(){i(this,e)}),this};var a,r="";return function(){var t,o={Webkit:"webkit",Moz:"",O:"o"},e=document.documentElement,n=function(o){return t?t+o:o.toLowerCase()};for(var i in o)if(void 0!==e.style[i+"TransitionProperty"]){r="-"+i.toLowerCase()+"-",t=o[i];break}a=n("TransitionEnd")}(),t});